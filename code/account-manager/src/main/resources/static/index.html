<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/accountmanager/webjars/vuetify/dist/vuetify.min.css">
  <link rel="stylesheet" href="/accountmanager/webjars/fortawesome__fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="index.css">
  <title>账号管理器</title>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
  <script src="/accountmanager/webjars/vue/dist/vue.global.prod.js"></script>
  <script src="/accountmanager/webjars/axios/dist/axios.min.js"></script>
  <script src="/accountmanager/webjars/vuetify/dist/vuetify.min.js"></script>
</head>

<body>

  <div id="app">
    <v-app>

      <!-- 左侧导航栏 -->
      <v-navigation-drawer permanent width="200">
        <v-toolbar title="账号管理器" color="blue" density="compact"></v-toolbar>
        <v-list>
          <v-list-item :active="accountShowFlag" title="账号" @click="moduleShow('accountShowFlag')"></v-list-item>
          <v-list-item :active="categoryShowFlag" title="分类" @click="moduleShow('categoryShowFlag')"></v-list-item>
          <v-list-item :active="transferShowFlag" title="迁移" @click="moduleShow('transferShowFlag')"></v-list-item>
          <v-list-item :active="configShowFlag" title="设置" @click="moduleShow('configShowFlag')"></v-list-item>
        </v-list>
      </v-navigation-drawer>

      <!-- 主体 -->
      <v-main>
        <v-container>

          <!-- 欢迎 -->
          <template v-if="helloShowFlag">
            <h1>欢迎使用账号管理器！</h1>
          </template>

          <!-- 账号 -->
          <template v-if="accountShowFlag">
            <v-row align="center">
              <v-col cols="2">
                <v-select label="分类筛选" 
                          v-model="accountTableQueryCategoryId"
                          :items="accountTableQueryCategoryDatas"
                          item-title="category_name"
                          item-value="id"
                          variant="underlined"
                          clearable 
                          clear-icon="fa-regular fa-circle-xmark">
                </v-select>                
              </v-col>
              <v-col cols="4">
                <v-text-field label="名称搜索" 
                              v-model="accountTableQueryKeywordAppName" 
                              variant="underlined"
                              clearable 
                              clear-icon="fa-regular fa-circle-xmark"
                              append-icon="fa-solid fa-magnifying-glass" 
                              @click:append="accountTableQuery()">
                </v-text-field>
              </v-col>
              <v-spacer></v-spacer>
              <v-col cols="auto">
                <v-btn variant="outlined" @click="accountEditDialogShow(null)">新增账号</v-btn>
              </v-col>
            </v-row>

            <v-row>
              <v-col>
                <v-data-table-server v-model:items-per-page="accountTablePageSize"
                  :page="accountTablePageNum"
                  :items-per-page-options="accountTablePageSizeOptions"
                  :items-per-page-text="accountTablePageSizeOptionsText"  
                  :headers="accountTableHeaders" 
                  :items="accountTableDatas"
                  :items-length="accountTableTotal" 
                  :loading="accountTableLoading" 
                  @update:options="accountTableQuery"
                  @update:page="accountTablePageNumHandle" 
                  show-current-page="true" 
                  first-icon="fa-solid fa-angles-left" prev-icon="fa-solid fa-angle-left" 
                  next-icon="fa-solid fa-angle-right" last-icon="fa-solid fa-angles-right">
                  <template v-slot:item.actions="{ item }">
                    <div class="d-flex ga-2 justify-end">
                      <v-icon size="small" @click="accountEditDialogShow(item)">
                        fa-solid fa-pen
                      </v-icon>
                      <v-icon size="small" color="red" @click="accountDelDialogShow(item)">
                        fa-regular fa-trash-can
                      </v-icon>
                    </div>
                  </template>
                </v-data-table-server>
              </v-col>
            </v-row>

            <v-dialog v-model="accountEditDialogShowFlag" width="auto">
              <v-card max-height="600" width="500" :title="accountEditDialogTitle">
                <v-form class="mx-8">
                  <v-select label="分类" 
                            v-model="accountDialogDataCategoryId"
                            :items="accountEditDialogCategoryDatas"
                            item-title="category_name"
                            item-value="id"
                            variant="outlined"
                            clearable 
                            clear-icon="fa-regular fa-circle-xmark">
                  </v-select>
                  <v-text-field label="名称" v-model="accountDialogDataAppName" variant="outlined"></v-text-field>
                  <v-text-field label="网址" v-model="accountDialogDataAppUrl" variant="outlined"></v-text-field>
                  <v-text-field label="账号" v-model="accountDialogDataUsername" variant="outlined"></v-text-field>
                  <v-text-field label="密码" v-model="accountDialogDataPassword" variant="outlined" append-inner-icon="fa-solid fa-shuffle" @click:append-inner="passwordGet">
                  </v-text-field>
                  <v-text-field label="备注" v-model="accountDialogDataRemark" variant="outlined"></v-text-field>
                </v-form>
                <v-card-actions class="mx-6 mb-4">
                  <v-btn @click="accountEditDialogClear()">取消</v-btn>
                  <!-- 弹性空间 -->
                  <v-spacer></v-spacer>
                  <v-btn color="green" @click="accountEdit()">提交</v-btn>
                </v-card-actions>
              </v-card>
            </v-dialog>

            <v-dialog v-model="accountDelDialogShowFlag" width="auto">
              <v-card max-height="500" width="400" title="删除账号">
                <v-card-text>
                  确定删除 {{ accountDialogDataAppName }} 账号吗？
                </v-card-text>
                <v-card-actions class="mx-6 mb-4">
                  <v-btn @click="accountDelDialogClear()">取消</v-btn>
                  <!-- 弹性空间 -->
                  <v-spacer></v-spacer>
                  <v-btn color="red" @click="accountDel()">确定</v-btn>
                </v-card-actions>
              </v-card>
            </v-dialog>
          </template>

          <!-- 分类 -->
          <template v-if="categoryShowFlag">
            <v-row>
              <v-spacer></v-spacer>
              <v-col cols="auto">
                <v-btn variant="outlined" @click="categoryEditDialogShow(null)">新增分类</v-btn>
              </v-col>
            </v-row>

            <v-row>
              <v-col>
                <v-data-table-server 
                  :headers="categoryTableHeaders" 
                  :items="categoryTableDatas"
                  :loading="categoryTableLoading" 
                  @update:options="categoryTableQueryAll" 
                  hide-default-footer>
                  <template v-slot:item.actions="{ item }">
                    <div class="d-flex ga-2 justify-end">
                      <v-icon size="small" @click="categoryEditDialogShow(item)">
                        fa-solid fa-pen
                      </v-icon>
                      <v-icon size="small" color="red" @click="categoryDelDialogShow(item)">
                        fa-regular fa-trash-can
                      </v-icon>
                    </div>
                  </template>
                </v-data-table-server>
              </v-col>
            </v-row>

            <v-dialog v-model="categoryEditDialogShowFlag" width="auto">
              <v-card max-height="500" width="400" :title="categoryEditDialogTitle">
                <v-form class="mx-8">
                  <v-text-field label="分类名称" v-model="categoryDialogDataCategoryName" variant="outlined" autofocus></v-text-field>
                </v-form>
                <v-card-actions class="mx-6 mb-4">
                  <v-btn @click="categoryEditDialogClear()">取消</v-btn>
                  <!-- 弹性空间 -->
                  <v-spacer></v-spacer>
                  <v-btn color="green" @click="categoryEdit()">提交</v-btn>
                </v-card-actions>
              </v-card>
            </v-dialog>

            <v-dialog v-model="categoryDelDialogShowFlag" width="auto">
              <v-card max-height="500" width="400" title="删除分类">
                <v-card-text>
                  确定删除 {{ categoryDialogDataCategoryName }} 分类吗？
                </v-card-text>
                <v-card-actions class="mx-6 mb-4">
                  <v-btn @click="categoryDelDialogClear()">取消</v-btn>
                  <!-- 弹性空间 -->
                  <v-spacer></v-spacer>
                  <v-btn color="red" @click="categoryDel()">确定</v-btn>
                </v-card-actions>
              </v-card>
            </v-dialog>
          </template>

          <!-- 迁移-->
          <template v-if="transferShowFlag">

            <v-file-input label="选择文件" prepend-icon="" append-icon="fa-solid fa-file-import"
              @change="handleUploadFileChange" @click:append="importRecordDatas"></v-file-input>

            <v-btn color="green-accent-3" @click="exportRecordDatas">导出</v-btn>

          </template>

          <!-- 设置 -->
          <template v-if="configShowFlag">
            <v-row>
              <v-col>
                <v-data-table-server 
                  :headers="configTableHeaders" 
                  :items="configTableDatas"
                  :loading="configTableLoading" 
                  @update:options="configTableQueryAll" 
                  hide-default-footer>
                  <template v-slot:item.actions="{ item }">
                    <div class="d-flex ga-2 justify-end">
                      <v-icon size="small" @click="configEditDialogShow(item)">
                        fa-solid fa-pen
                      </v-icon>
                    </div>
                  </template>
                </v-data-table-server>
              </v-col>
            </v-row>

            <v-dialog v-model="configEditDialogShowFlag" width="auto">
              <v-card max-height="500" width="400" title="修改配置">
                <v-form class="mx-8">
                  <v-text-field label="配置项" v-model="configDialogDataConfigKey" disabled variant="solo-inverted" focused></v-text-field>
                  <v-text-field label="配置值" v-model="configDialogDataConfigValue" variant="outlined" autofocus></v-text-field>
                  <v-text-field label="说明" v-model="configDialogDataRemark" disabled variant="solo-inverted" focused></v-text-field>
                </v-form>
                <v-card-actions class="mx-6 mb-4">
                  <v-btn @click="configEditDialogClear()">取消</v-btn>
                  <!-- 弹性空间 -->
                  <v-spacer></v-spacer>
                  <v-btn color="green" @click="configEdit()">提交</v-btn>
                </v-card-actions>
              </v-card>
            </v-dialog>
          </template>

          <!-- 报错弹框 -->
          <v-snackbar v-model="errSnackbarShowFlag" :timeout="errSnackbarTimeout" location="top" color="red-accent-2">
            {{ errSnackbarMsg }}
          </v-snackbar>

        </v-container>
      </v-main>

    </v-app>
  </div>

  <script src="index.js"></script>
</body>

</html>